# SQL実践Ⅰ
## 1. 取得したデータを加工する

###  1-1. DISTINCT (重複データを省く)
**DISTINCT** を用いると、検索結果から重複するデータを除くことが可能です。<br>
「DISTINCT(カラム名)」とすることで、検索結果から指定したカラムの重複するデータを除くことができます。<br>
DISTINCTはSELECTで取得するカラムに使用することで、重複を省いたデータを取得できます。

```SQL
  SELECT DISTINCT(カラム名)
  FROM テーブル名;
```

<br><br>

### 1-2. 四則演算
SQLでも四則演算「足す(+)、引く(-)、かける( *)、割る(/)」が可能です。四則演算子を用いることでカラムのデータを計算することが可能です。かける場合はアスタリスク( *)、割る場合はスラッシュ(/)を用いることに注意しましょう。<br>
DISTINCTと同様に、四則演算をSELECTで取得するカラムに使用することで、計算後のデータが取得できます。

```SQL
  -- 指定したカラムのデータに1.08をかける
  SELECT  カラム名 * 1.08
  FROM テーブル名;
```

<br><br>

## 2. 集計関数

### 2-1. SUM関数 (データの合計を求める)
Excelなどでよく目にするSUM関数ですが、SQLでも使用可能です。<br>
SQLで数値の合計を計算する場合は、SUMを用います。<br>
「 SUM(カラム名) 」のようにすることで、指定したカラムに保存されたデータの合計を計算することが可能です。<br>
SUM関数はWHEREと併用することも可能です。

```SQL
  SELECT SUM(カラム名)
  FROM テーブル名
  -- WHEREとの併用も可能
  WHERE  カラム名 = " ○ ○ "；
```

<br><br>

### 2-2. AVG関数 (データの平均を求める)
SQLで数値の平均を計算する場合は、AVGを用います。
**「AVG(カラム名)」** のようにすることで、指定したカラムに保存されたデータの平均を計算することが可能です。<br>
AVG関数はSELECTで取得するカラムに使用することで、計算結果を取得することができます。<br>
AVG関数もWHEREと併用することが可能です。

```SQL
  SELECT AVG(カラム名)
  FROM テーブル名
  -- WHEREとの併用も可能
  WHERE  カラム名 = " ○ ○ "；
```

<br><br>

### 2-3. COUNT関数 (データの数を求める)
COUNT関数は、指定したカラムのデータの合計数を計算してくれる関数です。<br>
**「COUNT( カラム名 )」** とすることで、指定したカラムのデータの数を計算します。<br>
COUNT関数でカラム名を指定した場合、nullになっているデータの数は計算されません。<br>
nullの数も含めてデータの数を計算したい場合は、COUNT関数で * (全てのカラム)を指定します。<br>
*を使った場合、特定のカラムのデータの数ではなく、レコードの数を計算します。この方法で、nullの数を含めてデータの数を数えられます。<br>
COUNT関数もWHEREと併用することができます。

```SQL
  SELECT AVG(カラム名)
  FROM テーブル名
  -- WHEREとの併用も可能
  WHERE  カラム名 = " ○ ○ "；

-- レコードの数を数える場合
  SELECT AVG(*)
  FROM テーブル名
```

<br><br>

### 2-4. MAX・MIN関数 (最大・最小のデータを求める)
SQLでMAXという関数を用いると、指定したカラムのデータの中から最大のデータを取得することができます。<br>
同じく、MINと言う関数を用いることで、最小のデータを取得することができます。<br>
MAX,MINも他の集計関数と同様にSELECTで取得したカラムに使用することができます。<br>
MAX,MINも他の集計関数と同様にWHEREと併用することができます。

```SQL
-- 最も大きいカラムの値を取得する
  SELECT MAX(カラム名)
  FROM テーブル名;

-- 最も小さいカラムの値を取得する
  SELECT MIN(カラム名)
  FROM テーブル名

  -- WHEREとの併用も可能
  WHERE  カラム名 = " ○ ○ "；
```

<br><br>

## 3. グループ化

### 3-1. GROUP BY (データをグループ化する)
GROUP BYを用いると、データをグループ化することができます。<br>
例えば「GROUP BY カラム名」とすることで、指定したカラムで、完全に同一のデータを持つレコードどうしが同じグループとなります。<br>

グループ化するには、今までの集計関数を取得するFROMの後ろに「GROUP BY カラム名」を追加します。集計関数により、各グループごとにデータが集計されます。<br>
GROUP BYを用いる場合、SELECTで使えるのは、GROUP BYに指定しているカラム名と、集計関数のみです。

```SQL
  SELECT  カラム名 A
  FROM テーブル名
  GROUP BY カラム名A;

  -- 集計関数を利用してグループ化をする
  SELECT  集計関数(カラム名A),カラム名B
  FROM テーブル名
  GROUP BY カラム名B;
```

<br><br>

### 3-2. 複数カラムのグループ化
GROUP BYは複数のカラム名を適用させることができ、その場合は、カラム名同士をコンマ(,)で繋げます。<br>
GROUP BYに複数のカラム名でグループ化をすると、データの組み合わせの数だけグループができます。<br>
複数カラムのGROUP BYでは集計関数により、各グループごとにデータを集計することができます。

```SQL
  SELECT  カラム名 A, カラム名B
  FROM テーブル名
  GROUP BY カラム名A, カラム名B;

  -- 集計関数を利用して複数カラムのグループ化をする
  SELECT  集計関数(カラム名A),カラム名B, カラム名C
  FROM テーブル名
  GROUP BY カラム名B, カラム名C;
```
<br><br>

### 3-3. HAVING (グループ化したデータをさらに絞り込む)
GROUP BYでグループ化したデータを更に絞り込みたい場合には、HAVINGを用います。<br>
「GROUP BY カラム名 HAVING 条件」のようにすることで、条件を満たすグループを取得することができます。

グループ化した後のデータを絞り込む際、WHEREではなくHAVINGを使うのは、SQLの各コマンドが以下の順番で実行されていくためです。<br>
WHEREはまず最初に、そのあとにGROUP BYと関数が実行され、その後にHAVINGが実行されます。

| ↓ | 上から順に |
|:-:|:-:|
|  検索 | WHERE  |
|  グループ化 | GROUP BY |
|  関数| COUNT・SUM・AVG・MAX・MIN |
|  HAVING| HAVING |

#### WHEREとHAVINGの違い
実行順序によって、WHEREとHAVINGは検索対象に違いがあります。<br>
WHEREはグループ化される前のテーブル全体を検索対象とするのに対し、HAVINGはGROUP BYによってグループ化されたデータを検索対象とします。<br>

HAVINGはグループ化された後のテーブルから検索するため、条件文で使うカラムは必ずグループ化されたテーブルのカラムを使います。

```SQL
  SELECT 集計関数(カラム名A), カラム名B
  FROM テーブル名
  GROUP BY カラム名B
  HAVING 集計関数(カラム名A) >= 1000;
```


※以下SQLⅢの内容記述予定