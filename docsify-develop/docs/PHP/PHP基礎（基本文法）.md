# PHP基礎（基礎文法）

### PHPの特徴
 HTML/CSS で作ったサイトと PHP で作ったサイトの違いですが、 HTML/CSS のほうは誰がいつ見ても同じサイトになりますが、 PHP を使うとユーザーのアクセス状況によって表示を変えることができます。<br>
たとえば、ログイン状況を検出して、ユーザー名を出し分けたりといった感じですね<br>

また、HTML/CSSのほうはいつ見ても同じ内容が配信されるので「静的サイト」、PHPはユーザによって違う内容が配信されるので「動的サイト」と呼ばれます。
SNS やショッピングサイトといった高度なウェブサービスを作るにはこちらの動的サイトの作り方を知っておく必要があります

<br><br>

#### PHPタグ
PHPコードの後にHTMLを配置する必要がなければ閉じタグは不要になります。
```php
<?php

include('footer.php');

```

<br><br>

#### 改行

```php

<?php

echo 'hello world' . PHP_EOL;
echo 'hi world'.'<br>';

?>

// 改行する際は文字列の後に「PHP_EOL」をつける
// または文字列の後に「'<br>'」をつける

```

<br><br>

#### コメントアウト

```php

コメントを残したい場合
// comment

# comment

複数行のコメントを残したい場合
/* 
comment
comment
*/

エディタにはショートカットが設定されていることが多く、
macOSでは「command + /」
Windowsでは「contorol + /」
でコメントの切り替えが可能

```

<br><br>

#### ヒアドキュメントについて(長めのテキストを表現する方法)

 <<<'EOT' 改行、 EOT; としてあげると、ここに書いたテキストの改行や字下げは保持したまま、 $text という変数に代入してくれます。

 ちなみにこちらは終端記号と呼ばれていて、好きな名前をつけて良いのですが、今回は End Of Text という意味で EOT としています。
 終端記号のあとは必ず改行をしてください。

 このままだと変数を埋め込むことができないのですが、実は ' を " にするか、もしくは単に終端記号だけにしてあげれば変数を埋め込むことができます。

```php

<?php

$name = 'tomoda';

// 長めのテキストを表現する
$text = <<<'EOT'
hello! 
  this is looooong
  text!
  
EOT;


// 変数を埋め込む
$text = <<<EOT
hello! $name
  this is looooong
  text!
  
EOT;

echo $text;


// $text = <<<'EOT'  //変数を展開しないnowdoc（ナウドキュメント）
// $text = <<<"EOT"  //変数を展開するのがheredoc（ヒアドキュメント）

```

<br><br>

#### 数値の計算

```php

<?php

// 四則演算
echo 10 + 3 . PHP_EOL; //13
echo 10 - 3 . PHP_EOL; //7
echo 10 * 3 . PHP_EOL; //30
echo 10 / 3 . PHP_EOL; //3.3333...

// 割った時の余り
echo 10 % 3 . PHP_EOL; //1

// 冪乗（べき乗）
echo 10 ** 3 . PHP_EOL; //1000

// 計算の優先順位
echo 2 + 10 * 3 . PHP_EOL; //32
echo (2 + 10) * 3 . PHP_EOL; //36

// PHPでは数値っぽい文字列を計算に使うと数なるべく値に変換しようとする
echo 2 + '3' . PHP_EOL; //5

```

<br><br>

#### 定数
変数を利用していると誤って再定義をしてしまうことがあります。<br>
それを防ぐために値を変えたくない場合は定数として定義します。<br>
定数の定義方法は２通りあって１つが「define()」を利用する方法。<br>
もう１つが「const」を使う方法です。<br>
なお、定数は慣習的に大文字になるのと、変数と違って $ は付かないので注意しておきましょう。<br>

```PHP

define('NAME', 'tomoda');

const NAME = 'tomoda';

```

<br><br>

#### データ型
PHP で扱うことができる主なデータの種類、つまりデータ型については以下の通りです。
| 主なデータ型 | 例 |
|:-:|:-:|:-:|
| 文字列（string） | 'hello' "hello" |
| 整数（int） | 5 -20 |
| 浮動小数点数（float） | 3.2 -1.8 |
| null | null |
| 真偽値（bool） | true, false |
| 配列（array） | [ ] |
| オブジェクト（object） | new Object() |

<br><br>

#### 変数の型を調べる

変数のデータ型を調べるには「var_dump関数」を利用します。

```PHP
$a = 'hello!';
$b = 10;
$c = -1. 3;
$d = null;
$e = true;

// 変数の方を調べる関数
var_dump($a);  // string(6) "hello!"
var_dump($b);  // int(10)
var_dump($c);  // float(-1.3)
var_dump($d);  // NULL
var_dump($d);  // bool(true)
```

<br><br>

#### 比較演算子

| 比較演算子| 意味 |
|:-:|:-:|:-:|
| >= | 〜以上 |
| <= | 〜以下 |
| > | 〜より大きい |
| < | 〜より小さい |
| === | 〜と等しい |
| !== | 〜と等しくない |

#### 論理演算子
| 論理演算子| 意味 |
|:-:|:-:|:-:|
| && , and | なおかつ |
| &#124;&#124; , or| または |
| ! | 〜ではない |

```PHP
<?php

$score = 60;
$name = 'tomoda';

// 複雑な条件式の場合にif文が入れ子になると見にくい
if ($score >= 50) {
  if ($name === 'tomoda') {
    echo 'Good Job!' . PHP_EOL;
  }
}
// 出力結果：　Good Job!'

// 論理演算子を利用して書き換えると入れ子にならず見やすい
if ($score >= 50 && $name === 'tomoda') {
  echo 'Good Job!' . PHP_EOL;
}
// 出力結果：　Good Job!'
```

<br><br>

#### 変数スコープ
PHP では関数の外で定義された変数を使うことはできないというルールがあります。<br>
関数の外で定義された変数を関数内で利用しようとしてもエラーになってしまいます。
もし関数外で定義された 変数 を使いたかった場合、変数は関数の外で定義されたものだよ、という意味で 「global」 というキーワードをつけなければなりません。<br>

ただ、この global を使ってしまうとコードが長くなったときに、どこで変数の値が変更されているか追いにくくなります。<br>
そこで、関数内で使う変数は基本的に引数で渡してあげるか、その関数内で定義してあげるほうがいいでしょう。

```PHP
<?php

$rate = 1.1; 
// グローバルスコープ 関数外で定義された変数

function sum($a, $b, $c)
{
  // global $rate; グローバルスコープの変数を利用する場合

  $rate = 1.08;
  // ローカルスコープ 関数内で定義された変数
  return ($a + $b + $c) * $rate;
}

echo sum(100, 200, 300) + sum(300, 400, 500) . PHP_EOL; 
// 1944

```

<br><br>

#### 無名関数
関数ですが、実は関数自体を値として扱うこともできます。<br>
値として扱えるので、変数に代入することができます。<br>
代入するのは処理だけにしたいので、 function のあとの名前は不要です。<br>
また普通の関数は最後に ; は不要ですが、このように値として代入する場合は ; が必要なので、注意しておいてください。<br>

それから関数を値として代入する場合は function のあとにスペースを入れるのと、改行をしないように気をつけましょう。<br>
値としてつかった関数には名前がないので「無名関数」、もしくは「クロージャー」と呼びます。<br>
無名関数を使えるようになると関数自体を別の関数の引数にして渡すことができたり、いろいろ便利です。

```PHP
<?php

$sum = function ($a, $b, $c) { // 無名関数
  return $a + $b + $c;
};

echo $sum(100, 300, 500) . PHP_EOL;

// 出力結果：　900
```

<br><br>

#### 条件演算子
条件演算子は「条件 ? 値 : 値」と記述します。
条件が true だった場合は前の値、 false だったらコロンから後ろの値で評価されるので、条件分岐と同じ意味になります。

```PHP
<?php
  $total = 1;

  // if文で条件分岐
  if ($total < 0) {
    return 0;
  } else {
    return $total;
  }

// 条件演算子を利用した分岐
  return $total < 0 ? 0 : $total;
}
```
<br><br>

#### 引数のデータ型を指定する
例を見ながら型付けについて見ていきましょう。<br>
showInfo() に $name と $score を渡すと、 : で区切って表示してくれるといった以下の関数を作ります。
```PHP
<?php

function showInfo( $name,  $score){
  echo $name . ': ' . $score . PHP_EOL;
}

showInfo('tomoda', 100);
// 出力結果：tomoda : 100
```
「tomoda : 100」とうまく出力されます。
ここでうっかり予期しない値を第二引数に、全然関係ない文字列を渡してしまったとします。しかし、エラーにならず出力はそのまま表示されてしまいます。<br>
ここで、以下のように第一引数には文字列、第二引数には数値しか受け付けないという指定をすることができます。

```PHP
// 各引数の前にデータ型を記述することで指定することが可能
function showInfo(  string $name,  int $score){
  echo $name . ': ' . $score . PHP_EOL;
}

showInfo('tomoda', 100);
// 各引数に指定されたデータ型の値を渡す
// 出力結果：tomoda : 100

showInfo('tomoda', 'hello');  
//第二引数に関係のない文字列を渡す
// 出力結果：エラー 
```
ただし、この型指定ですが、デフォルトでは **弱い型付け** という方式になっていて、実は違った型でも可能な限り正しい型に変換してしまうという点に注意しておいてください。<br>
例えば、第二引数に文字列の「'100'」という値を与えてみます。
```PHP
function showInfo(  string $name,  int $score){
  echo $name . ': ' . $score . PHP_EOL;
}

showInfo('tomoda', '100');
// 第二引数に文字列の数字を渡すとint型に変換されて出力してしまう
// 出力結果：tomoda : 100
```
もし変換してほしくない場合は **強い型付け** をする必要があります。<br>
その場合は  **「declare 文」** を最初に記述してください。

```PHP
declear(strict_type=1);
// declare 文をつける
function showInfo(  string $name,  int $score){
  echo $name . ': ' . $score . PHP_EOL;
}

showInfo('tomoda', '100');
// declare 文が文頭についたことによって指定された型以外が出力されることがなくなった。
// 出力結果：エラー
```
<br><br>

#### nullも渡せるようにする
以下のようなgetAward() という関数を作って、 $score を渡したら何らかの称号がもらえるという処理を書いてみます。

```PHP
<?php

declare(strict_types=1);
// 返り値に型を指定する場合は関数のカッコの後に「：データ型」をつける
function getAward(int $score):string {
  return $score >=100 ? 'Gold Medal' : null; 
}

echo getAward(150);
echo getAward(0);

// 出力結果：Gold Medal
// 出力結果：エラー
```
１番目の処理は成功しているが、返り値が「string」ではなく「null」のため２番目の処理はエラーが出てしまっている。<br>
ではどうするかですが、PHP では型の前に  **「?」**  マークを付けてあげると、 null かその型かという意味になります。

```PHP
<?php

declare(strict_types=1);
//  返り値がnull かstring型なら正常に処理が行われる
function getAward(int $score):?string {
  return $score >=100 ? 'Gold Medal' : null; 
}

echo getAward(150);
echo getAward(0);

// 出力結果：Gold Medal
// 出力結果：
```

<br><br>

#### 配列
配列 は、言語に組み込まれた array() で作成することが可能です。<br>
この構造は、 特定の数のカンマで区切られた キー => 値 の組を引数とします。
```PHP
array(
    key  => value,
    key2 => value2,
    key3 => value3,
)
```
最後の要素のあとのカンマは、書いても書かなくてもかまいません。<br>
 配列を一行で定義する場合は、ふつうは最後のカンマを省略します。つまり、 array(1, 2) のほうが array(1, 2, ) よりおすすめだということです。<br>
 しかし複数行で定義する場合は、最後のカンマをつけることが一般的です。 そうしておけば、配列の最後に要素を追加するのが容易になるからです。

>array() を [ ] で置き換えることが出来る、配列の短縮構文も使えます。

```PHP
<?php
$array = array(
    "foo" => "bar",
    "bar" => "foo",
);

// 配列の短縮構文
$array = [
    "foo" => "bar",
    "bar" => "foo",
];
?>
```

配列の中身ですが、中身をわかりやすく表示するには「 var_dump()」 か、もしくは変数に関する情報をわかりやすく見せてくれる 「print_r()」 という命令を使うと便利です。

```PHP
<?php

$scores = [
  90,
  40,
  100,
];

var_dump($scores);

出力結果------------
array(3) {
  [0]=>
  int(90)
  [1]=>
  int(40)
  [2]=>
  int(100)
}
------------------

print_r($scores);

出力結果：---------
Array
(
    [0] => 90
    [1] => 40
    [2] => 100
)
------------------
```
<br><br>

#### 配列に配列を入れ込む
配列の中に別の配列を入れたい場合は以下のように記述できます。
```PHP
<?php

$moreScores = [
  55,
  72,
];

$scores = [
  90,
  40,
  ...$moreScores, // 「...」を入れて変数を入力
  100,
];

出力結果：
Array
(
    [0] => 90
    [1] => 40
    [2] => 55
    [3] => 72
    [4] => 100
)
```

<br><br>

#### 可変長引数
引数が何個来ても合計が出せるような関数を作ります。
```PHP
<?php

// 仮引数「$numbers」の前に「...」を記述します。
// そうすると渡された全ての引数を配列にして、こちらに代入してくれます
function sum(...$numbers) 
{
  //「$total」という変数を定義します
  $total = 0;  

  // foreach文を用いて配列の各要素を順番に$numberで取り出し、
  // $total に足します
  foreach ($numbers as $number) {
    
    $total += $number;
  }
  // total を return 
  return $total;
}

echo sum(1, 3, 5) . PHP_EOL;
// 引数3つだと、出力結果：９
echo sum(4, 2, 5, 1) . PHP_EOL;
// 引数４つだと、出力結果：１２
```
上記のような引数を可変長引数と言います。

<br><br>

